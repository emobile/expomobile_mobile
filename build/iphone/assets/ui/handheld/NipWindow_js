function NipWindow(){var e=require("lib/network"),i="",t="",o=Ti.Database.open("anadicDB"),n=o.execute("SELECT name FROM users WHERE userId = 1;");o.execute("CREATE TABLE IF NOT EXISTS nip(nipId INTEGER PRIMARY KEY, nipNumber TEXT);");var a=o.execute("SELECT nipNumber FROM nip WHERE nipId = 1;");a.isValidRow()&&(t=a.fieldByName("nipNumber")),a.close(),n.isValidRow()?(i=n.fieldByName("name"),n.close(),("undefined"===i||"null"==i)&&(i="")):i="",o.close();var r=require("tools"),d=r.isiOS7Plus(),c=Ti.UI.createWindow({tabBarHidden:!0,backgroundColor:"black",width:"100%",layout:"vertical",height:Ti.UI.SIZE,fullscreen:d,navBarHidden:!0}),s=Ti.UI.createLabel({id:"labelPaso",height:"auto",width:"auto",text:L("step2"),font:{fontSize:"20dp",fontWeight:"bold"},color:"white"}),l=Ti.UI.createLabel({id:"labelUsuario",height:"auto",width:"90%",text:L("welcome")+" "+i+"!!",font:{fontSize:"20dp"},color:"#798d8d",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER}),u=Ti.UI.createLabel({id:"labelNIP",height:"auto",width:"90%",text:L("nip_mail"),font:{fontSize:"14dp"},color:"#798d8d",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER}),p=function(){h(),c.add(imageViewBar),c.add(scrollView_1)},g=function(){scrollView_1=Ti.UI.createScrollView({id:"scrollView_1",backgroundImage:"/images/background.png",height:"100%",left:0,top:0,width:"100%",layout:"vertical"})},h=function(){g(),I(),f(),scrollView_1.add(imageViewLogo),scrollView_1.add(l),scrollView_1.add(u),T(),scrollView_1.add(textFieldNip),w(),scrollView_1.add(buttonIngresar),scrollView_1.add(buttonAtras)},w=function(){buttonIngresar=Ti.UI.createImageView({id:"buttonIngresar",width:Ti.UI.SIZE,top:10}),buttonCorreo=Ti.UI.createImageView({id:"buttonCorreo",width:"95%",top:5}),buttonAtras=Ti.UI.createImageView({id:"buttonAtras",width:Ti.UI.SIZE,top:5}),"es"==L("language")?(buttonIngresar.image="/images/buttoningresar.png",buttonCorreo.image="/images/buttoncorreo.png",buttonAtras.image="/images/buttonsalir.png"):(buttonIngresar.image="/images/buttoningresar_e.png",buttonCorreo.image="/images/buttoncorreo_e.png",buttonAtras.image="/images/buttonsalir_e.png")},T=function(){textFieldNip=Ti.UI.createTextField({hintText:"Ingresar NIP",id:"textFieldNip",width:"60%",passwordMask:!0,value:t,borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED}),""!=t&&(textFieldNip.value=t)},f=function(){imageViewLogo=Ti.UI.createImageView({id:"imageViewLogo",image:"/images/anadic.png",height:235,top:10,width:178,verticalAlign:"center"})},I=function(){imageViewBar=Ti.UI.createView({id:"imageViewBar",backgroundColor:Ti.App.Properties.getString("viewcolor"),height:40,left:0,top:0,width:"100%"}),imageViewBar.add(s)};p(),""!=t&&(textFieldNip.value=t),buttonIngresar.addEventListener("click",function(){if(Ti.Media.vibrate(),""==!textFieldNip.value){var i=Ti.Database.open("anadicDB"),t=i.execute("SELECT id FROM users WHERE userId = 1;");e.getNip(t.fieldByName("id"),textFieldNip.value,function(e){if("ok"==e.access){var i=Ti.Database.open("anadicDB"),t=i.execute("SELECT nipNumber FROM nip WHERE nipId = 1;");t.isValidRow()||i.execute('INSERT INTO nip VALUES (1, "'+textFieldNip.value+'");'),t.close(),i.close(),textFieldNip.blur();var o,n=require("ui/handheld/MainWindow");new n(o).open()}}),i.close()}else Ti.UI.createAlertDialog({message:response.msg,ok:L("empty"),title:L("alert_title")}).show()}),buttonCorreo.addEventListener("click",function(){Ti.Media.vibrate(),Ti.Platform.openURL("http://www.google.com")});var m=!0;textFieldNip.addEventListener("focus",function b(){m?(m=!1,textFieldNip.blur()):textFieldNip.removeEventListener("focus",b)});var v=Ti.UI.createAlertDialog({title:L("alert_title"),message:L("closeapp"),buttonNames:[L("yes"),L("no")]});return v.addEventListener("click",function(e){0==e.index&&(Ti.Media.vibrate(),Ti.Android.currentActivity.finish())}),buttonAtras.addEventListener("click",function(){Ti.Media.vibrate(),v.show()}),c.addEventListener("android:back",function(){Ti.Media.vibrate(),v.show()}),c}module.exports=NipWindow;